# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка

```
export interface IProduct {
    description: string;
    image: string;
    title: string,
    category: string,
    price: number | null;
    _id: string;
}
```

Пользователь

```
export interface IPerson {
    address: string;
    email: string;
    phone: string;
}
```

Интерфейс для модели данных карточек товаров

export interface IProductsData {
products: IProduct[];
preview: string | null;
setProducts(products: IProduct[]): void;
getProduct(productId: string): IProduct | null;
}

Данные карточки товара в листинге

```
export type TProductCard = Pick<IProduct, 'title' | 'category' | 'image' | 'price'>;
```

Данные карточки товара в модальном окне при клике на товар

```
export type TProductModal = Pick<IProduct, 'title' | 'category' | 'image' | 'price' | 'description'>;
```

Данные карточки товара в корзине

```
export type TProductBasket = Pick<IProduct, 'title' | 'price'>;
```

Данные пользователя в модальном окне Способы оплаты

```
export type TPersonPay = Pick<IPerson, 'address'>;
```

Данные пользователя в модальном окне с контактами

```
export type TPersonContacts = Pick<IPerson, 'email' | 'phone'>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице;
- слой данных, отвечает за хранение и изменение данных;
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс ProductsData

Содержит данные карточек товаров в листинге, данные о состоянии просматриваемой карточки и метод вызова попапа с подробными данными карточки.\
В полях класса содержатся следующие данные:

- \_products: IProduct[] - массив объектов товаров;
- \_preview: string | null - состояние id просматриваемой карточки товара;
- setProducts(products: IProduct[]): void - метод получения данных каталога из апи;
- getProduct(productId: string): IProduct | null - метод вызова попапа карточки.

#### Класс PersonData

Отвечает за логику работы с персональными данными покупателя

- setPersonData(personData: IPerson): void - сохраняет данные покупателя в классе;\
- checkPayValidation(data: Record<keyof TPersonPay, string>): boolean - проверяет валидность данных в поле ввода адреса;
- checkContactsValidation(data: Record<keyof TPersonContacts, string>): boolean; - проверяет валидность данных в полях номер телефона и почта.

### Слой представления

Все классы представления отвечают за отображение передаваемых в них данных внутри контейнера с использованием элементов DOM.

#### Класс Modal

Реализует модальное окно. Так же содержит методы `open` и `close`для управления отображением модального окна. Устанавливает слушатели на клавиатуру для закрытия модального окна при клике по кнопке Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.

- constructor(selector: string, events: IEvents) - конструктор принимает селектор, по которому будет идентифицировано модальное окно в разметке и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:

- modal: HTMLElement - элемент модального окна
- events: IEvents - брокер событий

#### Класс ModalWithProduct

Расширяет класс Modal. Предназначен для реализации модального окна с детальной информацией о товаре. При открытии модального окна, получает данные о товаре, который нужно показать. При `onclick` инициирует событие, отправляя объект с данными о товаре в Корзину.
Поля класса:

- imageElement: HTMLImageElement - элемент разметки с изображением товара
- categoryElement: HTMLElement - элемент разметки для вывода категории товара
- titleElement: HTMLElement - элемент разметки для вывода названия товара
- descriptionElement: HTMLElement - элемент разметки для вывода описания товара
- priceElement: HTMLElement - элемент разметки для вывода стоимости товара
- onclickButton: HTMLButtonElement - кнопка покупки

Методы:

- open(data: {}) - метод для открытия модального окна с данными о товаре при клике на карточку товара. При вызове метода заполняются элементы разметки данными о товаре.
- close(): void - расширяет родительский метод, выполняя дополнительно очистку атрибутов модального окна и дает возможность закрыть модальное окно кликом на кнопку Купить.
- addToBasket(): void - метод для добавления товара в корзину, вызывается при нажатии на кнопку "В корзину". Отправляет данные о товаре в корзину и вызывает метод `close()`.

#### Класс ModalWithBasket

Расширяет класс Modal. Предназначен для реализации модального окна с корзиной товаров, которое открывается при клике на иконку корзины. При открытии модального окна, отображается массив выбранных товаров.

Поля класса:

- numberElement: HTMLElement - элемент нумерации товара
- titleElement: HTMLElement - элемент разметки для вывода названия товара
- priceElement: HTMLElement - элемент разметки для вывода стоимости товара
- onclickButton: HTMLButtonElement - кнопка удаления товара из корзины
- priceTotal: HTMLElement - элемент, отображающий сумму покупок
- checkoutButton: HTMLButtonElement - кнопка для перехода к оформлению покупки.

Методы:

- open(data: {}) - метод для открытия модального окна с данными о товарах в корзине.
- close(): void - расширяет родительский метод, выполняя дополнительно очистку атрибутов модального окна.
- removeFromBasket(itemId: number): void - метод для удаления товара из корзины, принимает идентификатор товара для удаления. После удаления, обновляет отображение корзины.
- calculateTotal(): number - метод для подсчета стоимости товаров в корзине
- proceedToCheckout(): void -метод для перехода к оформлению покупки.

#### Класс ModalWithCheckout

Расширяет класс Modal. Реализует процесс оформления покупки в два шага. На первом шаге выбирается способ оплаты и вводится адрес доставки. На втором шаге необходимо ввести контактную информацию и завершить оформление.

Поля класса:

- optionButton: NodeList - коллекция кнопок выбора способов оплаты
- \_form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- inputs: NodeListOf<HTMLInputElement> - коллекция всех поллей ввода формы
- onclickButton: HTMLButtonElement - кнопка перехода к следующему попапу

Методы:

- setValid(isValid: boolean): void - изменяет активность кнопки перехода к следующему попапу
- setInputValues(data: Record<string, string>: void) - принимает объект с данными полей формы.
- close (): void - расширяет родительский метод дополнительно при закрытии, очищая поля формы и деактивируя кнопку перехода
- get form: HTMLElement - геттер для получения элемента формы.

#### Класс Product

Отвечает за отображение карточки товара, задавая в карточке данные категории, названия, изображения, стоимости, описания. В конструктор класса передается DOM элемент темплейта для реализации массива карточек. В классе устанавливается слушатели событий для реализации разных сценариев.\
Поля класса содержат элементы разметки элементов карточки. Кроме темплейта конструктор принимает экземпляр `EventEmitter` для инициализации событий.\

Методы:

- setData(productData: IProduct, productId: string): void - заполняет атрибуты элементов карточки данными
- deleteProduct(): void - метод для удаления карточки из корзины.
- render(): HTMLElement - возвращает заполненную карточку с установленными слушателями (для корзины).

#### Класс ProductsContainer

Отвечает за вывод блока с карточками товаров на главной странице. Предоставляет сеттер `container` для добавления карточек товаров с сервера.

### Слой коммуникации

#### Класс AppApi

Принимает в конструктор класс Api и предоставляет методы, реализующие взаимодействие с бэкэндом сервиса.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой, находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.\
В `index.ts` сначала создаются экземпляры всех необходиых классов, а затем настраивается обработка событий.

_Список всех событий, которые могут генерироваться в системе:_\

_События изменения данных (генерируются классами моделями данных)_

- `product:selected` - изменение открываемой в модальном окне карточки товара.

_События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)_

- `product: open` - открытие карточки товара для отображения в модальном окне
- `product: previewClear` - очистка данных выбранной для показа карточки товара
- `product: add` - добавление товара в корзину
- `product: remove` - удаление товара из корзины
- `basket: open` - открытие корзины в модальном окне
- `basket: onclick` - клик по кнопке оформить заказ
- `button-card: onclick` - клик по кнопке Оплатить картой
- `button-cash: onclick` - клик по кнопке Оплатить при получении
- `order: input` - ввод данных в форму с адресом
- `order: validation` - валидация формы с адресом
- `order-button: onclick` - клик по кнопке Далее (на второй попап оформления заказа)
- `contacts: input` - ввод данных в форму контактных данных
- `contacts: validation` -валидация формы контактных данных
- `pay-batton: onclick` - клик по кнопке Оплатить
